---
trigger: always_on
---

# プロジェクト開発ガイドライン & コードスタイル

本プロジェクト「X Mobile Optimization」の開発における、コード規約、設計思想、およびこれまでの重要な決定事項をまとめたドキュメントです。

## 1. プロジェクトの目的と哲学

**「Web版Xを、ネイティブアプリを超える体験へ」**

- **Native Feel First**: アニメーション、遷移、タッチインタラクションは、Webサイト的ではなく、ネイティブアプリ（特にiOS）のような「重み」や「物理挙動（Spring Physics）」を感じさせるものを目指します。
- **Attention to Detail**: 1pxのズレ、一瞬のチラつき、違和感のある挙動を許容しません。ユーザー体験（UX）を最優先します。
- **Stability**: どんなに美しいアニメーションも、機能（ツイート表示など）を阻害してはなりません。

## 2. 実装済み重要機能 & 仕様メモ

これまでの開発で決定・実装された主要な挙動です。変更を加える際は、これらを後退させないように注意してください。

### A. 画像ビューア (Custom Lightbox)
- **スライダートラック方式**: 画像単体ではなく、トラック全体またはスライド単位で管理し、スワイプでの連続的な閲覧を可能にする。
- **スワイプクローズ (Y軸)**:
  - 下方向へのスワイプで閉じる。
  - **仕様**: トラック全体を縮小するのではなく、**現在表示中の画像（スライド）のみ**が移動・縮小する。
  - **終了アニメーション**: 元のサムネイル位置に向かって縮小しながらフェードアウトする（Zoom Out to Origin）。
- **スワイプナビゲーション (X軸)**:
  - 左右スワイプで画像切り替え。
  - **フリック対応**: 移動距離が短くても、速度（Velocity）が速ければ切り替え判定を行う。
- **高画質化**: 可能であれば `name=large` などの高画質画像をロードする。

### B. ツイート詳細画面 (/status/)
- **スケルトン無効化**: 詳細画面ではリプライ読み込み等のReact動作と拡張機能のDOM操作が競合しやすいため、スケルトンローディング機能は**厳格に無効化（CSS非表示 & JS判定スキップ）**する。

### C. アニメーション全般
- **スプリング物理**: `cubic-bezier(0.1, 0.9, 0.2, 1)` のような、摩擦とバネを感じさせるイージングを使用する。
- **GPUアクセラレーション**: `transform`, `opacity` 以外のプロパティ（`top`, `width` 等）のアニメーションは極力避ける。

## 3. 言語とコメント規約

- **言語**: 日本語
  - コード内のコメント、ドキュメント、コミットメッセージはすべて**日本語**で記述。
- **命名規則**: 英語 (CamelCase / snake_case)
  - 変数名、関数名は英語で、説明的な名前を使用。
- **絵文字**: **使用禁止** (厳守)
  - コミットメッセージ、コード内コメント含め、一切使用しない。

## 4. コミットメッセージ規約 (Prefix)

| Prefix | 説明 | 例 |
| :--- | :--- | :--- |
| `fix` | バグ修正 | `fix: 画像ビューアのフェードアウト位置を修正` |
| `hotfix` | 重大なバグ修正 | `hotfix: 起動時のクラッシュを修正` |
| `add` | 新機能・ファイル追加 | `add: 設定ポップアップの実装` |
| `update` | 機能改善・修正 | `update: スワイプ感度の調整` |
| `change` | 仕様変更 | `change: アニメーション曲線の変更` |
| `clean` | コード整理 | `clean: 未使用の変数を削除` |
| `disable`| 機能無効化 | `disable: 開発者ログを無効化` |
| `remove` | 削除 | `remove: 不要なCSSファイルを削除` |
| `upgrade`| 依存更新 | `upgrade: ビルドスクリプトの更新` |
| `revert` | 取消 | `revert: 前回コミットを取り消し` |

## 5. ディレクトリ構成 & 役割

- `src/content_scripts/`
  - `animator.js`: アニメーション、インタラクション効果、ライトボックス等のUI挙動を担当。
  - `optimizer.js`: 広告除去、サイドバー削除、DOMの軽量化等の「削る」処理を担当。
- `src/assets/`: アイコン等の静的リソース。

---
**最終更新**: 2025/12/31
